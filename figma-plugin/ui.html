<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Image Size Converter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
      color: #333;
      padding: 16px;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .preview-section {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }

    .preview-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .preview-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
    }

    .refresh-button {
      width: 20px;
      height: 20px;
      border: none;
      background: #f0f0f0;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: background-color 0.2s;
    }

    .refresh-button:hover {
      background: #e0e0e0;
    }

    .preview-image {
      width: 200px;
      height: 200px;
      border: 1px solid #e5e5e5;
      border-radius: 4px;
      background: #f9f9f9;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      overflow: hidden;
    }

    .preview-image img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .preview-placeholder {
      color: #999;
      font-size: 12px;
    }

    .button {
      padding: 12px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      position: relative;
    }

    .button-primary {
      background: #18a0fb;
      color: white;
    }

    .button-primary:hover:not(:disabled) {
      background: #0d8ce8;
    }

    .button-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .button-secondary:hover:not(:disabled) {
      background: #e0e0e0;
    }

    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .loading-spinner {
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .hidden {
      display: none !important;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .status-message {
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
      margin-top: 8px;
    }

    .status-success {
      background: #e8f5e8;
      color: #2d5a2d;
      border: 1px solid #c3e6c3;
    }

    .status-error {
      background: #ffeaea;
      color: #8b0000;
      border: 1px solid #ffcccc;
    }

    .status-info {
      background: #e8f4fd;
      color: #1e5a8a;
      border: 1px solid #b3d9ff;
    }

    .export-instructions {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      padding: 12px;
      font-size: 13px;
      line-height: 1.4;
    }

    .export-instructions h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .export-instructions ol {
      margin: 0;
      padding-left: 16px;
    }

    .export-instructions li {
      margin-bottom: 4px;
    }

    .export-instructions .highlight {
      background: #fff3cd;
      padding: 1px 4px;
      border-radius: 3px;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ -->
    <div class="preview-section">
      <div class="preview-header">
        <span class="preview-title">ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</span>
        <button class="refresh-button" id="refreshButton" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
      </div>
      <div class="preview-image" id="previewImage">
        <div class="preview-placeholder">ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      </div>
    </div>

    <!-- ë³€í™˜ ë²„íŠ¼ -->
    <button class="button button-primary" id="convertButton">
      <span id="convertText">ì´ë¯¸ì§€ ë³€í™˜</span>
      <div class="loading-spinner hidden" id="convertSpinner"></div>
    </button>

    <!-- ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ -->
    <button class="button button-secondary" id="exportButton">
      <span id="exportText">í”„ë ˆì„ ë‚´ë³´ë‚´ê¸°</span>
      <div class="loading-spinner hidden" id="exportSpinner"></div>
    </button>

    <!-- ì´ˆê¸°í™” ë²„íŠ¼ -->
    <button class="button button-secondary" id="resetButton">
      <span id="resetText">ì´ˆê¸°í™”</span>
      <div class="loading-spinner hidden" id="resetSpinner"></div>
    </button>

    <!-- ë‚´ë³´ë‚´ê¸° ì•ˆë‚´ -->
    <div id="exportInstructions" class="export-instructions hidden">
      <h4>ğŸ“ Figma Export ì‚¬ìš© ë°©ë²•</h4>
      <ol>
        <li><span class="highlight" id="frameCount">í”„ë ˆì„ë“¤ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤</span></li>
        <li>Figma ìš°ì¸¡ íŒ¨ë„ì˜ <span class="highlight">"Export"</span> ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”</li>
        <li><span class="highlight">"Export N layers"</span> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
        <li>í´ë” êµ¬ì¡°ê°€ ìë™ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤</li>
      </ol>
    </div>

    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
    <div id="statusMessage" class="status-message hidden"></div>
  </div>

  <script>
    // DOM ìš”ì†Œë“¤
    const previewImage = document.getElementById('previewImage');
    const refreshButton = document.getElementById('refreshButton');
    const convertButton = document.getElementById('convertButton');
    const convertText = document.getElementById('convertText');
    const convertSpinner = document.getElementById('convertSpinner');
    const exportButton = document.getElementById('exportButton');
    const exportText = document.getElementById('exportText');
    const exportSpinner = document.getElementById('exportSpinner');
    const resetButton = document.getElementById('resetButton');
    const resetText = document.getElementById('resetText');
    const resetSpinner = document.getElementById('resetSpinner');
    const exportInstructions = document.getElementById('exportInstructions');
    const statusMessage = document.getElementById('statusMessage');

    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    refreshButton.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'get-preview' } }, '*');
    });

    // ë³€í™˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    convertButton.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'convert-images' } }, '*');
    });

    // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    exportButton.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'export-frames' } }, '*');
    });

    // ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    resetButton.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'reset-images' } }, '*');
    });

    // ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      console.log('UI ë©”ì‹œì§€ ìˆ˜ì‹ :', msg.type);

      switch (msg.type) {
        case 'preview-success':
          showPreview(msg.imageData);
          showStatusMessage('ë¯¸ë¦¬ë³´ê¸°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          break;

        case 'preview-error':
          showPreviewError(msg.message);
          showStatusMessage(msg.message, 'error');
          break;

        case 'conversion-started':
          startConvertLoading();
          showStatusMessage('ì´ë¯¸ì§€ ë³€í™˜ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
          break;

        case 'conversion-completed':
          clearConvertLoading();
          showStatusMessage('ì´ë¯¸ì§€ ë³€í™˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          break;

        case 'export-started':
          startExportLoading();
          showStatusMessage('í”„ë ˆì„ì„ ì„ íƒí•˜ëŠ” ì¤‘...', 'info');
          break;

        case 'export-completed':
          clearExportLoading();
          showStatusMessage('ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          exportInstructions.classList.remove('hidden');
          const frameCountElement = document.getElementById('frameCount');
          if (frameCountElement) {
            frameCountElement.textContent = `${msg.frameCount}ê°œì˜ í”„ë ˆì„ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`;
          }
          break;

        case 'reset-started':
          startResetLoading();
          showStatusMessage('ì´ë¯¸ì§€ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì¤‘...', 'info');
          break;

        case 'reset-completed':
          clearResetLoading();
          showStatusMessage(msg.message, 'success');
          break;

        case 'error':
          clearAllLoading();
          showStatusMessage(msg.message, 'error');
          break;
      }
    };

    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
    function showPreview(imageData) {
      previewImage.innerHTML = `<img src="data:image/png;base64,${imageData}" alt="ë¯¸ë¦¬ë³´ê¸°">`;
    }

    // ë¯¸ë¦¬ë³´ê¸° ì˜¤ë¥˜ í‘œì‹œ
    function showPreviewError(message) {
      previewImage.innerHTML = `<div class="preview-placeholder">${message}</div>`;
    }

    // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
    function showStatusMessage(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message status-${type}`;
      statusMessage.classList.remove('hidden');
      
      // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
      setTimeout(() => {
        statusMessage.classList.add('hidden');
      }, 3000);
    }

    // ë¡œë”© ìƒíƒœ ê´€ë¦¬
    function startConvertLoading() {
      convertButton.disabled = true;
      convertText.textContent = 'ë³€í™˜ ì¤‘';
      convertSpinner.classList.remove('hidden');
    }

    function clearConvertLoading() {
      convertButton.disabled = false;
      convertText.textContent = 'ì´ë¯¸ì§€ ë³€í™˜';
      convertSpinner.classList.add('hidden');
    }

    function startExportLoading() {
      exportButton.disabled = true;
      exportText.textContent = 'ì„ íƒ ì¤‘';
      exportSpinner.classList.remove('hidden');
    }

    function clearExportLoading() {
      exportButton.disabled = false;
      exportText.textContent = 'í”„ë ˆì„ ë‚´ë³´ë‚´ê¸°';
      exportSpinner.classList.add('hidden');
    }

    function startResetLoading() {
      resetButton.disabled = true;
      resetText.textContent = 'ì´ˆê¸°í™” ì¤‘';
      resetSpinner.classList.remove('hidden');
    }

    function clearResetLoading() {
      resetButton.disabled = false;
      resetText.textContent = 'ì´ˆê¸°í™”';
      resetSpinner.classList.add('hidden');
    }

    function clearAllLoading() {
      clearConvertLoading();
      clearExportLoading();
      clearResetLoading();
    }

    // í”ŒëŸ¬ê·¸ì¸ ì‹œì‘ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ
    parent.postMessage({ pluginMessage: { type: 'get-preview' } }, '*');
  </script>
</body>
</html>
